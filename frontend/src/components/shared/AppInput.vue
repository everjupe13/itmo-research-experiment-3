<script lang="ts" setup>
import { computed, ref } from 'vue'

import { generateRandomString } from '@/utils'

const props = defineProps({
  type: {
    type: String,
    default: 'text'
  },
  placeholder: {
    type: String,
    default: undefined
  },
  id: {
    type: String,
    default: undefined
  },
  modelValue: {
    type: String,
    default: ''
  },
  readonly: {
    type: Boolean,
    default: false
  },
  loading: {
    type: Boolean,
    default: false
  }
})

const emit = defineEmits<{
  (e: 'update:modelValue', value: string): void
  (e: 'input', value: string): void
  (e: 'change', value: string): void
}>()

const autogeneratedId = ref(generateRandomString())
const elId = computed(() => props.id ?? autogeneratedId.value)

const onInput = (event: Event) => {
  emit('input', (event.target as HTMLInputElement).value)
  emit('update:modelValue', (event.target as HTMLInputElement).value)
}

const onChange = (event: Event) => {
  emit('change', (event.target as HTMLInputElement).value)
  emit('update:modelValue', (event.target as HTMLInputElement).value)
}
</script>

<template>
  <input
    :id="elId"
    :type="props.type"
    :placeholder="props.placeholder"
    :value="props.modelValue"
    :readonly="props.readonly"
    :class="['app-input', { '--disabled': props.readonly || props.loading }]"
    @input="onInput"
    @change="onChange"
  />
</template>

<style scoped>
.app-input {
  padding: 7px 9px;
  font-size: 14px;
  font-weight: 500;

  border-radius: 3px;
  border: 1px solid transparent;
  border-color: var(--c-input-border);

  background-color: var(--c-input-bg);
  color: var(--c-input-color);

  transition: 0.2s;
}

.app-input:read-only {
  outline: 0;
  opacity: 0.7;
}
.app-input.--disabled {
  outline: 0;
  opacity: 0.7;
}

.app-input::placeholder {
  color: var(--c-input-placeholder);
}
</style>
